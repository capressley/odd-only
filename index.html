<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Odd-Only Arcade</title>

<style>
  body{
    margin:0;
    font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background:#0b0b0d;
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    padding:16px;
  }
  .hidden{display:none}
  .card{
    width:min(520px,92vw);
    background:#121217;
    border-radius:18px;
    padding:18px;
    box-shadow:0 20px 50px rgba(0,0,0,.6);
    text-align:center;
    position:relative;
    overflow:hidden;
  }
  img{
    width:100%;
    border-radius:14px;
    margin-bottom:12px;
    border:1px solid rgba(255,255,255,.10);
    background:#000;
  }
  h1{margin:10px 0}
  p{color:#bdbdd1; line-height:1.4}
  button{
    width:100%;
    margin-top:12px;
    padding:16px;
    font-size:20px;
    font-weight:800;
    border:none;
    border-radius:14px;
    cursor:pointer;
    background:#57c66b;
    color:#0b0b0d;
  }
  .secondary{
    background:#2a2a35;
    color:#fff;
  }
  .hud{
    display:flex;
    justify-content:space-between;
    gap:10px;
    margin-bottom:12px;
    font-weight:800;
    flex-wrap:wrap;
  }
  #number{
    font-size:88px;
    font-weight:900;
    margin:18px 0 8px;
    user-select:none;
  }
  .toast{
    min-height:20px;
    color:#bdbdd1;
    font-size:14px;
    margin-top:10px;
  }

  /* Flash overlay for strike removal */
  #flash{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.72);
    font-weight:1000;
    font-size:34px;
    letter-spacing:1px;
    text-transform:uppercase;
    opacity:0;
    pointer-events:none;
  }
  #flash.show{
    animation: flashPop 900ms ease-in-out forwards;
  }
  @keyframes flashPop{
    0%   { opacity:0; transform:scale(.95); }
    15%  { opacity:1; transform:scale(1.02); }
    60%  { opacity:1; transform:scale(1.00); }
    100% { opacity:0; transform:scale(.98); }
  }
</style>
</head>

<body>

<!-- WELCOME -->
<div id="welcome" class="card">
  <img src="welcome.png" alt="Odd-Only Arcade">
  <h1>Odd-Only Arcade</h1>
  <p>
    Numbers (1–999) flash at an erratic cadence.<br><br>
    <b>Tap ONLY when the number is odd.</b><br>
    • Tap odd: <b>+1 point</b><br>
    • Tap even: <b>-1 point</b> + <b>1 strike</b><br>
    • <b>Miss an odd</b> (it disappears untapped): <b>-1 point</b> + <b>1 strike</b><br><br>
    <b>3 strikes</b> and you’re out.<br>
    Every <b>10</b> successfully tapped odds removes <b>1 strike</b> (min 0).
  </p>
  <button id="startBtn">START</button>
</div>

<!-- GAME -->
<div id="game" class="card hidden">
  <div class="hud">
    <div>Score: <span id="score">0</span></div>
    <div>Strikes: <span id="strikes">0</span>/3</div>
    <div>Odd taps: <span id="oddCount">0</span>/10</div>
  </div>

  <div id="number">—</div>

  <button id="tapBtn">Tap ONLY if odd</button>
  <div id="gameMsg" class="toast"></div>

  <div id="flash">Strike removed!</div>
</div>

<!-- GAME OVER -->
<div id="over" class="card hidden">
  <img src="welcome.png" alt="Odd-Only Arcade">
  <h1>Game Over</h1>
  <p>Final score: <b id="finalScore">0</b></p>

  <button id="shareFinalBtn" class="secondary">Share score</button>
  <button id="againBtn">Play Again</button>
  <div id="overMsg" class="toast"></div>
</div>

<script>
  // ---------- ELEMENTS ----------
  const welcome = document.getElementById("welcome");
  const game = document.getElementById("game");
  const over = document.getElementById("over");

  const startBtn = document.getElementById("startBtn");
  const tapBtn = document.getElementById("tapBtn");
  const againBtn = document.getElementById("againBtn");
  const shareFinalBtn = document.getElementById("shareFinalBtn");

  const numberEl = document.getElementById("number");
  const scoreEl = document.getElementById("score");
  const strikesEl = document.getElementById("strikes");
  const oddCountEl = document.getElementById("oddCount");
  const finalScoreEl = document.getElementById("finalScore");

  const gameMsg = document.getElementById("gameMsg");
  const overMsg = document.getElementById("overMsg");
  const flashEl = document.getElementById("flash");

  // ---------- STATE ----------
  let score = 0;
  let strikes = 0;
  let current = null;

  let timer = null;
  let running = false;
  let paused = false;

  // For "missed odd" logic
  let currentOddWasTapped = false;

  // Prevent multiple scoring taps per shown number
  let tappedThisNumber = false;

  // Count successful odd taps toward strike removal
  let successfulOddTaps = 0; // 0..10

  // ---------- SPEED CONTROL ----------
  function nextDelayMs(){
    const base = 950; // increase to slow down
    const jitter = (Math.random() * 400) - 200;
    return Math.max(600, base + jitter);
  }

  function randInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function updateHUD(){
    scoreEl.textContent = String(score);
    strikesEl.textContent = String(strikes);
    oddCountEl.textContent = String(successfulOddTaps);
  }

  function stopTimer(){
    clearTimeout(timer);
    timer = null;
  }

  function pauseWithFlash(message){
    paused = true;
    stopTimer();

    flashEl.textContent = message;
    flashEl.classList.remove("show");
    // force reflow so animation restarts reliably
    void flashEl.offsetWidth;
    flashEl.classList.add("show");

    setTimeout(() => {
      flashEl.classList.remove("show");
      paused = false;
      if (running) tick();
    }, 900);
  }

  // ---------- GAME LOOP ----------
  function applyMissedOddPenaltyIfNeeded(){
    // If previous number was odd and it wasn't tapped before disappearing:
    if (current !== null && (current % 2 === 1) && !currentOddWasTapped){
      score -= 1;
      strikes += 1;
      gameMsg.textContent = "Missed odd: -1 and +1 strike";
      updateHUD();

      if (strikes >= 3){
        endGame();
        return true; // game ended
      }
    }
    return false;
  }

  function showNextNumber(){
    // Resolve the previous number outcome before changing it
    const ended = applyMissedOddPenaltyIfNeeded();
    if (ended) return;

    current = randInt(1, 999);
    numberEl.textContent = String(current);

    // Reset per-number flags
    currentOddWasTapped = false;
    tappedThisNumber = false;
  }

  function tick(){
    if (!running || paused) return;
    showNextNumber();
    if (!running || paused) return;
    timer = setTimeout(tick, nextDelayMs());
  }

  function startGame(){
    score = 0;
    strikes = 0;
    current = null;
    currentOddWasTapped = false;
    tappedThisNumber = false;
    successfulOddTaps = 0;

    updateHUD();
    gameMsg.textContent = "";
    overMsg.textContent = "";

    running = true;
    paused = false;
    stopTimer();

    welcome.classList.add("hidden");
    over.classList.add("hidden");
    game.classList.remove("hidden");

    tick();
  }

  function endGame(){
    if (!running) return;

    running = false;
    paused = false;
    stopTimer();

    // If the game ends while an odd is showing and it wasn't tapped, count it as missed:
    // (This keeps the rule consistent even if game ends mid-cycle.)
    if (current !== null && (current % 2 === 1) && !currentOddWasTapped){
      score -= 1;
      strikes = Math.min(3, strikes + 1);
    }

    finalScoreEl.textContent = String(score);

    game.classList.add("hidden");
    over.classList.remove("hidden");
  }

  // ---------- INPUT ----------
  tapBtn.onclick = () => {
    if (!running || paused || current === null) return;

    if (tappedThisNumber) return;
    tappedThisNumber = true;

    if (current % 2 === 1){
      // Successful odd tap
      score += 1;
      currentOddWasTapped = true;

      successfulOddTaps = Math.min(10, successfulOddTaps + 1);

      // If we've hit 10 successful odd taps, remove a strike (if any)
      if (successfulOddTaps >= 10){
        successfulOddTaps = 0;

        if (strikes > 0){
          strikes -= 1;
          gameMsg.textContent = "10 odds! Strike removed.";
          updateHUD();
          pauseWithFlash("Strike removed!");
          return;
        } else {
          gameMsg.textContent = "10 odds! (No strikes to remove.)";
        }
      } else {
        gameMsg.textContent = "Good: +1";
      }

      updateHUD();
    } else {
      // Even tap
      score -= 1;
      strikes += 1;

      gameMsg.textContent = `Even tap: -1 and +1 strike (${strikes}/3)`;
      updateHUD();

      if (strikes >= 3) endGame();
    }
  };

  shareFinalBtn.onclick = async () => {
    const url = location.href;
    const text = `Odd-Only Arcade — I scored ${score}. Can you beat it? ${url}`;

    try{
      if (navigator.share){
        await navigator.share({ title:"Odd-Only Arcade", text, url });
        overMsg.textContent = "Shared!";
        return;
      }
    }catch{
      // fall through
    }

    try{
      if (navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(text);
        overMsg.textContent = "Copied share text!";
      } else {
        overMsg.textContent = text;
      }
    }catch{
      overMsg.textContent = text;
    }
  };

  startBtn.onclick = startGame;
  againBtn.onclick = () => location.reload();
</script>

</body>
</html>
