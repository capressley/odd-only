<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Odd-Only Arcade</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#111111" />

  <style>
    :root{
      --bg:#0b0b0d;
      --panel:#121217;
      --text:#f2f2f2;
      --muted:#b8b8c2;
      --green:#57c66b;
      --green2:#2aa84a;
      --red:#e65252;
      --btn:#57c66b;
      --btnText:#0b0b0d;
      --shadow: 0 16px 40px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 900px at 50% 30%, rgba(87,198,107,.18), transparent 60%),
                  radial-gradient(900px 700px at 20% 80%, rgba(255,170,0,.10), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    .app{
      width: min(520px, 100%);
    }

    .card{
      background: rgba(18,18,23,.92);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .screen{
      display:none;
      padding:18px;
    }
    .screen.active{display:block;}

    .hero{
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      display:block;
      background:#000;
    }

    h1{
      margin:14px 0 6px;
      font-size: 22px;
      letter-spacing:.4px;
      text-align:center;
    }
    .sub{
      margin:0 0 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
      text-align:center;
    }

    .rules{
      margin: 10px 0 16px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 12px 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.45;
    }
    .rules b{color:#fff}

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    button{
      appearance:none;
      border:none;
      border-radius: 14px;
      padding: 14px 16px;
      font-size: 18px;
      font-weight: 800;
      cursor:pointer;
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      transition: transform .06s ease, filter .12s ease;
    }
    button:active{ transform: scale(.98); }
    button.primary{
      background: linear-gradient(180deg, var(--btn), var(--green2));
      color: var(--btnText);
      min-width: 180px;
    }
    button.secondary{
      background: rgba(255,255,255,.08);
      color: #fff;
      border: 1px solid rgba(255,255,255,.12);
      font-weight:700;
      font-size: 15px;
      padding: 12px 14px;
    }

    /* Game UI */
    .hud{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin: 6px 0 14px;
      flex-wrap:wrap;
    }
    .pill{
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 13px;
      color: var(--muted);
    }
    .pill b{ color:#fff; }

    .numberWrap{
      display:flex;
      justify-content:center;
      align-items:center;
      height: 160px;
      margin: 8px 0 14px;
    }
    #number{
      font-size: 84px;
      font-weight: 900;
      letter-spacing: 1px;
      text-shadow: 0 10px 26px rgba(0,0,0,.55);
      user-select:none;
    }

    #tap{
      width: 100%;
      padding: 18px 16px;
      font-size: 24px;
      border-radius: 18px;
    }

    .toast{
      margin-top: 12px;
      text-align:center;
      color: var(--muted);
      font-size: 13px;
      min-height: 18px;
    }

    .leader{
      margin-top: 14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 12px 14px;
    }
    .leader h2{
      margin:0 0 8px;
      font-size: 14px;
      letter-spacing:.6px;
      color:#fff;
      text-transform: uppercase;
    }
    .leader ol{
      margin:0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.45;
    }
    .leader li b{ color:#fff; }

    .danger{ color: var(--red); font-weight:800; }
    .ok{ color: var(--green); font-weight:800; }

    .small{
      font-size: 12px;
      color: var(--muted);
      text-align:center;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="card">

      <!-- WELCOME -->
      <section id="screenWelcome" class="screen active">
        <img id="welcomeImg" class="hero" src="welcome.png" alt="Odd-Only Arcade" />
        <h1>Odd-Only Arcade</h1>
        <p class="sub">Sharpen focus. Trust your pattern-recognition instincts. Don’t get baited by evens.</p>

        <div class="rules">
          <b>How to play</b><br>
          • Numbers flash between <b>1–999</b>.<br>
          • Tap the button <b>ONLY when the number is odd</b>.<br>
          • If you tap on an <b>even</b> number, you lose a strike and your score drops by 1.<br>
          • After <b>3 strikes</b>, the game ends.<br>
          • Score: <b>+1</b> for correct odd taps, <b>-1</b> for even taps (can go negative).
        </div>

        <div class="row">
          <button id="btnStart" class="primary" type="button">START</button>
        </div>

        <div id="welcomeMsg" class="toast"></div>
      </section>

      <!-- GAME -->
      <section id="screenGame" class="screen">
        <div class="hud">
          <div class="pill">Score: <b id="score">0</b></div>
          <div class="pill">Strikes: <b id="strikes">0</b> / 3</div>
          <div class="pill">Best: <b id="best">0</b></div>
        </div>

        <div class="numberWrap">
          <div id="number">1</div>
        </div>

        <button id="tap" class="primary" type="button">Tap ONLY if odd</button>

        <div class="row">
          <button id="btnShare" class="secondary" type="button">Share score</button>
          <button id="btnQuit" class="secondary" type="button">Quit</button>
        </div>

        <div id="gameMsg" class="toast"></div>

        <div class="leader">
          <h2>Local Leaderboard</h2>
          <ol id="board"></ol>
        </div>

        <div class="small">Scores save on this device/browser (like an old cabinet at a specific arcade).</div>
      </section>

      <!-- GAME OVER -->
      <section id="screenOver" class="screen">
        <img class="hero" src="welcome.png" alt="Odd-Only Arcade" />
        <h1>Game Over</h1>
        <p class="sub">Final score: <span id="finalScore" class="ok">0</span> &nbsp;•&nbsp; Strikes: <span id="finalStrikes" class="danger">3</span></p>

        <div class="row">
          <button id="btnPlayAgain" class="primary" type="button">PLAY AGAIN</button>
        </div>

        <div class="row">
          <button id="btnShare2" class="secondary" type="button">Share score</button>
          <button id="btnBackHome" class="secondary" type="button">Home</button>
        </div>

        <div class="leader">
          <h2>Local Leaderboard</h2>
          <ol id="board2"></ol>
        </div>

        <div id="overMsg" class="toast"></div>
      </section>

    </div>
  </div>

  <script>
    // ----- Elements
    const screenWelcome = document.getElementById("screenWelcome");
    const screenGame    = document.getElementById("screenGame");
    const screenOver    = document.getElementById("screenOver");

    const btnStart     = document.getElementById("btnStart");
    const btnQuit      = document.getElementById("btnQuit");
    const btnShare     = document.getElementById("btnShare");
    const btnPlayAgain = document.getElementById("btnPlayAgain");
    const btnBackHome  = document.getElementById("btnBackHome");
    const btnShare2    = document.getElementById("btnShare2");

    const numberEl   = document.getElementById("number");
    const tapBtn     = document.getElementById("tap");
    const scoreEl    = document.getElementById("score");
    const strikesEl  = document.getElementById("strikes");
    const bestEl     = document.getElementById("best");

    const finalScoreEl   = document.getElementById("finalScore");
    const finalStrikesEl = document.getElementById("finalStrikes");

    const welcomeMsg = document.getElementById("welcomeMsg");
    const gameMsg    = document.getElementById("gameMsg");
    const overMsg    = document.getElementById("overMsg");

    const boardEl  = document.getElementById("board");
    const boardEl2 = document.getElementById("board2");

    // ----- State
    let score = 0;
    let strikes = 0;
    let current = 1;

    let running = false;
    let timerId = null;

    const LS_BEST = "oddOnly_bestScore";
    const LS_BOARD = "oddOnly_leaderboard"; // [{i:"ABC", s:123, t:timestamp}]

    // ----- Helpers
    function show(screen){
      screenWelcome.classList.remove("active");
      screenGame.classList.remove("active");
      screenOver.classList.remove("active");
      screen.classList.add("active");
    }

    function safeToast(el, msg){
      el.textContent = msg || "";
    }

    function randInt(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function nextNumber(){
      current = randInt(1, 999);
      numberEl.textContent = String(current);
    }

    // Erratic cadence: base around 520ms with random jitter, occasional quick flash
    function nextDelayMs(){
      const base = 520;
      const jitter = randInt(-180, 220);    // makes it feel irregular
      const spike = (Math.random() < 0.14) ? randInt(-240, -120) : 0; // occasional faster blip
      return Math.max(220, base + jitter + spike);
    }

    function tick(){
      if (!running) return;
      nextNumber();
      timerId = setTimeout(tick, nextDelayMs());
    }

    function stopTimer(){
      if (timerId) clearTimeout(timerId);
      timerId = null;
    }

    function loadBest(){
      const n = Number(localStorage.getItem(LS_BEST) || "0");
      return Number.isFinite(n) ? n : 0;
    }

    function saveBestIfNeeded(){
      const best = loadBest();
      if (score > best){
        localStorage.setItem(LS_BEST, String(score));
      }
      bestEl.textContent = String(loadBest());
    }

    function loadBoard(){
      try{
        const raw = localStorage.getItem(LS_BOARD);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      }catch{
        return [];
      }
    }

    function saveBoard(arr){
      localStorage.setItem(LS_BOARD, JSON.stringify(arr));
    }

    function renderBoard(){
      const list = loadBoard()
        .sort((a,b) => (b.s - a.s) || (b.t - a.t))
        .slice(0, 10);

      function fill(ol){
        ol.innerHTML = "";
        if (!list.length){
          const li = document.createElement("li");
          li.textContent = "No scores yet.";
          ol.appendChild(li);
          return;
        }
        for (const entry of list){
          const li = document.createElement("li");
          li.innerHTML = `<b>${entry.i}</b> — ${entry.s}`;
          ol.appendChild(li);
        }
      }

      fill(boardEl);
      fill(boardEl2);
    }

    function maybeSaveToLeaderboard(){
      const best = loadBest();
      // If score isn't at least close to meaningful, you can change this rule.
      // For now: prompt initials if score >= best OR score >= 5
      if (score < 5 && score < best) return;

      let initials = prompt("Enter 3-letter initials for the leaderboard:", "AAA");
      if (!initials) return;

      initials = initials.toUpperCase().replace(/[^A-Z0-9]/g, "").slice(0, 3);
      if (!initials) initials = "???";

      const board = loadBoard();
      board.push({ i: initials, s: score, t: Date.now() });
      saveBoard(board);
      renderBoard();
    }

    function updateHUD(){
      scoreEl.textContent = String(score);
      strikesEl.textContent = String(strikes);
      bestEl.textContent = String(loadBest());
    }

    function resetGame(){
      score = 0;
      strikes = 0;
      current = 1;
      running = false;
      stopTimer();
      numberEl.textContent = "1";
      safeToast(gameMsg, "");
      updateHUD();
    }

    function startGame(){
      resetGame();
      show(screenGame);
      running = true;
      nextNumber();
      updateHUD();
      tick();
    }

    function endGame(){
      running = false;
      stopTimer();
      saveBestIfNeeded();
      finalScoreEl.textContent = String(score);
      finalStrikesEl.textContent = String(strikes);
      renderBoard();
      show(screenOver);

      // Save to leaderboard on game over
      setTimeout(() => {
        maybeSaveToLeaderboard();
        renderBoard();
      }, 50);
    }

    function shareScore(){
      const url = location.href;
      const text = `Odd-Only Arcade — I scored ${score} (3-strike mode). Can you beat it? ${url}`;

      if (navigator.share){
        navigator.share({ title: "Odd-Only Arcade", text, url }).catch(() => {});
        return;
      }

      if (navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text)
          .then(() => safeToast(gameMsg, "Copied share text!"))
          .catch(() => safeToast(gameMsg, text));
        return;
      }

      safeToast(gameMsg, text);
    }

    function shareFinal(){
      const url = location.href;
      const text = `Odd-Only Arcade — I scored ${score} (3 strikes). Beat that. ${url}`;

      if (navigator.share){
        navigator.share({ title: "Odd-Only Arcade", text, url }).catch(() => {});
        return;
      }

      if (navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text)
          .then(() => safeToast(overMsg, "Copied share text!"))
          .catch(() => safeToast(overMsg, text));
        return;
      }

      safeToast(overMsg, text);
    }

    // ----- Events
    btnStart.addEventListener("click", startGame);

    btnQuit.addEventListener("click", () => {
      running = false;
      stopTimer();
      show(screenWelcome);
    });

    btnPlayAgain.addEventListener("click", startGame);

    btnBackHome.addEventListener("click", () => {
      running = false;
      stopTimer();
      show(screenWelcome);
    });

    btnShare.addEventListener("click", shareScore);
    btnShare2.addEventListener("click", shareFinal);

    tapBtn.addEventListener("click", () => {
      if (!running) return;

      // If odd: +1
      if (current % 2 === 1){
        score += 1;
        safeToast(gameMsg, "Nice. ✅");
      } else {
        // If even: -1 and strike
        score -= 1;
        strikes += 1;
        safeToast(gameMsg, `Oof. ❌ Strike ${strikes}/3`);
        if (strikes >= 3){
          updateHUD();
          endGame();
          return;
        }
      }

      updateHUD();
    });

    // ----- Init
    // Render leaderboard + best
    bestEl.textContent = String(loadBest());
    renderBoard();

    // Service worker (GitHub Pages safe path: repo is /odd-only/)
    if ("serviceWorker" in navigator){
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/odd-only/sw.js").catch(() => {});
      });
    }
  </script>
</body>
</html>
