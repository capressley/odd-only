<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Odd-Only Arcade</title>

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      text-align: center;
    }

    .screen {
      display: none;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 14px;
    }

    .active { display: flex; }

    img {
      max-width: 92vw;
      width: min(520px, 92vw);
      height: auto;
      border-radius: 14px;
      box-shadow: 0 0 40px rgba(0,255,140,0.20);
    }

    h1, h2 { margin: 8px 0; }

    .instructions {
      opacity: 0.9;
      line-height: 1.35;
      max-width: 520px;
    }

    button {
      padding: 14px 26px;
      font-size: 20px;
      border: none;
      border-radius: 12px;
      background: #66cc66;
      color: #000;
      cursor: pointer;
      font-weight: 800;
      width: min(420px, 92vw);
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    button.secondary {
      background: rgba(255,255,255,0.10);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.16);
    }

    #number {
      font-size: 84px;
      font-weight: 900;
      margin: 10px 0 6px;
      text-shadow: 0 0 22px rgba(0,255,140,0.18);
    }

    #score {
      font-size: 22px;
      opacity: 0.95;
      margin-bottom: 8px;
    }

    /* Leaderboard */
    .board {
      width: min(520px, 92vw);
      text-align: left;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px;
      box-sizing: border-box;
    }

    .boardTitle {
      font-weight: 900;
      letter-spacing: 0.5px;
      opacity: 0.95;
      margin-bottom: 10px;
    }

    .row {
      display: grid;
      grid-template-columns: 40px 1fr 80px;
      gap: 10px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      align-items: center;
    }
    .row:last-child { border-bottom: none; }

    .rank { opacity: 0.8; font-weight: 800; }
    .name { font-weight: 900; letter-spacing: 0.08em; }
    .pts { text-align: right; font-weight: 900; }

    /* Initials entry */
    .initialsWrap {
      display: none;
      width: min(520px, 92vw);
      gap: 10px;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .initialsInputs {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }

    input.initial {
      width: 64px;
      height: 64px;
      font-size: 28px;
      text-align: center;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: #fff;
      font-weight: 900;
      text-transform: uppercase;
      outline: none;
    }

    .toast {
      min-height: 22px;
      opacity: 0.9;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- WELCOME -->
  <div id="welcome" class="screen active">
    <img src="welcome.png" alt="Odd-Only Arcade">
    <h1>Odd-Only Arcade</h1>
    <div class="instructions">
      Tap ONLY when the number is <b>odd</b>.<br>
      Miss an odd number (it changes before you tap): <b>‚àí1</b>.<br>
      Tap an even number: <b>Game Over</b>.
    </div>
    <button id="startBtn">START</button>

    <div class="board" style="margin-top:10px;">
      <div class="boardTitle">üèÜ High Scores</div>
      <div id="leaderboard"></div>
    </div>
  </div>

  <!-- GAME -->
  <div id="game" class="screen">
    <div id="score">Score: 0</div>
    <div id="number">7</div>
    <button id="tapBtn">Tap ONLY if odd</button>
    <div class="instructions" style="opacity:.75; font-size: 14px;">
      Numbers change on a slow, erratic cadence. Stay sharp.
    </div>
    <button id="quitBtn" class="secondary">Quit</button>
  </div>

  <!-- END -->
  <div id="end" class="screen">
    <img src="welcome.png" alt="Game Over">
    <h2>Game Over</h2>
    <div id="finalScore" style="font-size: 20px; font-weight: 900;"></div>

    <button id="shareBtn" class="secondary">Share Score</button>

    <div id="initialsWrap" class="initialsWrap">
      <div class="instructions" style="margin-top:6px;">
        New high score ‚Äî enter initials:
      </div>
      <div class="initialsInputs">
        <input id="i1" class="initial" maxlength="1" inputmode="text" />
        <input id="i2" class="initial" maxlength="1" inputmode="text" />
        <input id="i3" class="initial" maxlength="1" inputmode="text" />
      </div>
      <button id="saveBtn">Save Score</button>
    </div>

    <div class="board">
      <div class="boardTitle">üèÜ High Scores</div>
      <div id="leaderboardEnd"></div>
    </div>

    <div id="toast" class="toast"></div>

    <button id="againBtn">Play Again</button>
    <button id="backBtn" class="secondary">Back to Welcome</button>
  </div>

<script>
  // ===== Elements =====
  const welcome = document.getElementById("welcome");
  const game = document.getElementById("game");
  const end = document.getElementById("end");

  const startBtn = document.getElementById("startBtn");
  const againBtn = document.getElementById("againBtn");
  const tapBtn = document.getElementById("tapBtn");
  const quitBtn = document.getElementById("quitBtn");
  const backBtn = document.getElementById("backBtn");

  const scoreEl = document.getElementById("score");
  const numberEl = document.getElementById("number");
  const finalScoreEl = document.getElementById("finalScore");

  const shareBtn = document.getElementById("shareBtn");
  const toastEl = document.getElementById("toast");

  const boardEl = document.getElementById("leaderboard");
  const boardEndEl = document.getElementById("leaderboardEnd");

  const initialsWrap = document.getElementById("initialsWrap");
  const saveBtn = document.getElementById("saveBtn");
  const i1 = document.getElementById("i1");
  const i2 = document.getElementById("i2");
  const i3 = document.getElementById("i3");

  // ===== Leaderboard storage =====
  const LS_KEY = "oddOnlyHighScores_v1";
  const MAX_SCORES = 10;

  function loadScores() {
    try {
      const raw = localStorage.getItem(LS_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      if (!Array.isArray(arr)) return [];
      return arr
        .filter(x => x && typeof x.name === "string" && typeof x.score === "number")
        .map(x => ({ name: x.name.slice(0,3).toUpperCase(), score: Math.trunc(x.score) }))
        .sort((a,b) => b.score - a.score)
        .slice(0, MAX_SCORES);
    } catch {
      return [];
    }
  }

  function saveScores(arr) {
    localStorage.setItem(LS_KEY, JSON.stringify(arr.slice(0, MAX_SCORES)));
  }

  function qualifies(score, scores) {
    // allow negatives during play; only save > 0 to keep board meaningful
    if (score <= 0) return false;
    if (scores.length < MAX_SCORES) return true;
    return score > (scores[scores.length - 1]?.score ?? 0);
  }

  function renderScores() {
    const scores = loadScores();
    const html = scores.length
      ? scores.map((s, idx) => `
          <div class="row">
            <div class="rank">${String(idx+1).padStart(2,"0")}</div>
            <div class="name">${s.name}</div>
            <div class="pts">${s.score}</div>
          </div>
        `).join("")
      : `<div style="opacity:.75;">No scores yet. Be the first.</div>`;

    boardEl.innerHTML = html;
    boardEndEl.innerHTML = html;
  }

  // ===== Game state =====
  let score = 0;
  let current = 7;
  let running = false;
  let timer = null;

  // "missed odd" tracking:
  // If an odd number appears and changes before you tap, you lose 1.
  let lastWasOdd = false;
  let tappedDuringThisNumber = false;

  // Timing: constant average + small erratic cadence (no ramping)
  const BASE_MS = 950;      // slower
  const VAR_MS  = 260;      // erratic range

  function randInt(a, b) {
    return Math.floor(a + Math.random() * (b - a + 1));
  }

  function nextDelay() {
    return Math.max(300, BASE_MS + randInt(-VAR_MS, VAR_MS));
  }

  function show(screen) {
    welcome.classList.remove("active");
    game.classList.remove("active");
    end.classList.remove("active");
    screen.classList.add("active");
  }

  function setToast(msg) {
    toastEl.textContent = msg || "";
  }

  function newNumber() {
    // apply "missed odd" penalty for the previous number
    if (lastWasOdd && !tappedDuringThisNumber) {
      score -= 1;
    }

    current = randInt(1, 999);
    numberEl.textContent = String(current);

    lastWasOdd = (current % 2 === 1);
    tappedDuringThisNumber = false;

    scoreEl.textContent = "Score: " + score;
  }

  function tick() {
    if (!running) return;
    newNumber();
    timer = setTimeout(tick, nextDelay());
  }

  function startGame() {
    clearTimeout(timer);
    timer = null;

    score = 0;
    running = true;

    lastWasOdd = false;
    tappedDuringThisNumber = false;

    scoreEl.textContent = "Score: 0";
    numberEl.textContent = "7";
    setToast("");

    initialsWrap.style.display = "none";
    i1.value = ""; i2.value = ""; i3.value = "";

    show(game);
    newNumber();
    tick();
  }

  function endGame() {
    running = false;
    clearTimeout(timer);
    timer = null;

    finalScoreEl.textContent = "Final Score: " + score;

    // show initials entry only if qualifies
    const scores = loadScores();
    if (qualifies(score, scores)) {
      initialsWrap.style.display = "flex";
      setTimeout(() => i1.focus(), 50);
    } else {
      initialsWrap.style.display = "none";
    }

    renderScores();
    show(end);
  }

  // Tap: odd = +1, even = game over (and counts as "tapped")
  tapBtn.addEventListener("click", () => {
    if (!running) return;

    if (current % 2 === 1) {
      score += 1;
      tappedDuringThisNumber = true;
      scoreEl.textContent = "Score: " + score;
      // optional: immediate fresh number after correct tap
      newNumber();
    } else {
      tappedDuringThisNumber = true;
      endGame();
    }
  });

  // ===== Initials + save =====
  function cleanChar(ch) {
    const up = (ch || "").toUpperCase();
    return /^[A-Z0-9]$/.test(up) ? up : "";
  }

  function wireInput(inp, next) {
    inp.addEventListener("input", () => {
      inp.value = cleanChar(inp.value);
      if (inp.value && next) next.focus();
    });
    inp.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && !inp.value) {
        if (inp === i3) i2.focus();
        if (inp === i2) i1.focus();
      }
    });
  }
  wireInput(i1, i2);
  wireInput(i2, i3);
  wireInput(i3, null);

  saveBtn.addEventListener("click", () => {
    const name =
      (cleanChar(i1.value) || "A") +
      (cleanChar(i2.value) || "A") +
      (cleanChar(i3.value) || "A");

    const scores = loadScores();
    scores.push({ name, score });
    scores.sort((a,b) => b.score - a.score);
    saveScores(scores);

    initialsWrap.style.display = "none";
    setToast("Saved.");
    renderScores();
  });

  // ===== Share score =====
  shareBtn.addEventListener("click", async () => {
    const url = window.location.href.split("?")[0];
    const text = `I scored ${score} on Odd-Only Arcade. Beat that: ${url}`;

    try {
      if (navigator.share) {
        await navigator.share({ title: "Odd-Only Arcade", text, url });
        setToast("Shared!");
        return;
      }
    } catch { /* ignore */ }

    try {
      await navigator.clipboard.writeText(text);
      setToast("Copied to clipboard ‚Äî paste into a text.");
    } catch {
      setToast(text);
    }
  });

  // ===== Navigation buttons =====
  startBtn.addEventListener("click", startGame);
  againBtn.addEventListener("click", startGame);

  quitBtn.addEventListener("click", () => {
    running = false;
    clearTimeout(timer);
    timer = null;
    renderScores();
    show(welcome);
  });

  backBtn.addEventListener("click", () => {
    renderScores();
    show(welcome);
  });

  // Init board on load
  renderScores();
</script>

</body>
</html>
